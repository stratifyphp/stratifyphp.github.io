<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Stratify - Your application, your architecture</title>

            <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
        <link href="http://stratifyphp.github.io/css/highlight.github.css" rel="stylesheet">
        <link href="http://stratifyphp.github.io/css/all.min.css" rel="stylesheet">
    </head>
<body>

    <header>
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://stratifyphp.github.io/">Stratify</a>
                </div>
                <div class="collapse navbar-collapse" id="top-navigation">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://stratifyphp.github.io/docs/">Documentation</a></li>
                        <li><a href="http://stratifyphp.github.io/middlewares/">Middlewares</a></li>
                        <li><a class="github" href="https://github.com/stratifyphp"><i class="fa fa-github"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    
    <div class="container documentation">

        <div class="sidebar">
            <ul>
                                    <li>
                        Components

                        <ul>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/component/http.html">
                                        Http
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/component/router.html">
                                        Router
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    <li>
                        Framework

                        <ul>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/getting-started.html">
                                        Getting started
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/modules.html">
                                        Modules
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/extended-callables.html">
                                        Extended callables
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                            </ul>
        </div>

        <article>
            <h1 id="modules">Modules</h1>
<p>A Stratify module boils down to:</p>
<ul>
<li>a lower-case name (e.g. <code>my-module</code>)</li>
<li>a <a href="http://docs.puli.io/en/latest/glossary.html#glossary-package">Puli package</a> whose Puli root path is the module name (e.g. <code>/my-module</code>)</li>
<li>a <a href="http://php-di.org/">PHP-DI</a> configuration file inside that package (located at <code>/my-module/config/config.php</code>)</li>
</ul>
<p>A module can also contain more things like PHP classes (e.g. middlewares), resources (views, JS, CSS, …).</p>
<p>The Puli package allows to expose resources (views, JS, CSS, …). It can be seen as PSR-4/autoloading for resources. That will be used for example to find and load the module's configuration file.</p>
<p>With the configuration, a module is able to expose pre-configured objects (services, middlewares, …) and offer extension points on these objects.</p>
<h2 id="using-a-module">Using a module</h2>
<p>To use a module, you need to install it with Composer and then register it in the application:</p>
<pre><code class="language-php">$modules = [
    'module1',
    'module2',
    'module3',
    'app',
];

$app = new Application($http, $modules);</code></pre>
<p>That will automatically register the Puli packages as well as PHP-DI's config files.</p>
<p>Note that each module config is registered in the order of the list. If some modules override others, you need to register them <em>after</em> the module they override. For example, it is highly recommended to register the <code>app</code> module last to be able to override everything in your local configuration.</p>
<h2 id="the">The <code>app</code> module</h2>
<p>While modules can be reusable and isolated Composer packages, they can also be full applications.</p>
<p>As a matter of fact, you should write an application-style project <em>as a Stratify module</em>. Just like <a href="http://symfony.com/doc/current/best_practices/creating-the-project.html#application-bundles">Symfony's <code>AppBundle</code></a>, you are encouraged to use the generic <code>app</code> name for that application module.</p>
<h2 id="writing-a-module">Writing a module</h2>
<h3 id="file-layout">File layout</h3>
<pre><code>src/
    ...
res/
    config/
        config.php
    ...
composer.json
puli.json</code></pre>
<p>The <code>composer.json</code> file contains the package information (name, license, …) as well as PSR-4 configuration to autoload PHP classes stored in <code>src/</code>.</p>
<p>The <code>puli.json</code> file contains configuration for mapping virtual Puli paths (<code>/my-module/…</code>) to filesystem paths (<code>res/…</code>). To create it, use the <code>puli map</code> command:</p>
<pre><code class="language-bash">puli map /my-module res/</code></pre>
<h3 id="configuration">Configuration</h3>
<p>The module's configuration is stored in <code>res/config/config.php</code>. The syntax you can use is documented in <a href="http://php-di.org/doc/php-definitions.html">PHP-DI's documentation</a>.</p>
<h4 id="example">Example</h4>
<p>Here is an example of a configuration for a very basic &quot;Twig module&quot;:</p>
<pre><code class="language-php">return [
    Twig_Environment::class =&gt; function ($container) {
        $twig = new Twig_Environment(new PuliTemplateLoader);
        $twig-&gt;setExtensions($container-&gt;get('twig.extensions'));
        return $twig;
    },
    'twig.extensions' =&gt; [],
];</code></pre>
<p>In this example, the module configuration:</p>
<ul>
<li>defines how to create <code>Twig_Environment</code> so that Twig can be injected and used in the application</li>
<li>exposes the <code>twig.extensions</code> array (empty by default) so that you can register extensions in your application's config. Here is an example on how you can use that extension point to register your custom Twig extension:
<pre><code class="language-php">return [
    'twig.extensions' =&gt; add([
        get(MyTwigExtension::class),
    ]),
];</code></pre></li>
</ul>
<p>Note that this example shouldn't be actually used: Stratify provides a Twig module already.</p>
<h3 id="resources">Resources</h3>
<p>Resources are stored in the <code>res/</code> directory. Resources can be anything that isn't a PHP class: configuration, assets, translations, views, … You are encouraged to follow <a href="http://docs.puli.io/en/latest/repository/directory-layout.html">Puli's recommended file layout</a>:</p>
<pre><code class="language-bash">res/
    config/
    public/
        css/
        js/
        images/
    trans/ # translation files
    views/ # Twig/Blade/… templates</code></pre>
<p>All module resources can be accessed using Puli and its virtual &quot;Puli paths&quot;, for example: <code>/module-name/public/js/main.js</code>. Read more about it in <a href="http://docs.puli.io/en/latest/repository/introduction.html#how-it-works">Puli's documentation</a>.</p>
        </article>

    </div>


            <footer>
            <div class='container'>
                                    <p>
                        A question? Unsatisfied with the documentation?
                        Please <a href="https://github.com/PHP-DI/PHP-DI/issues/new">create an issue</a>
                        or chat on
                        <a href="https://gitter.im/PHP-DI/PHP-DI">Gitter</a> or
                        <a href="https://twitter.com/phpdi">Twitter</a>.
                    </p>
                                <p>
                    By <a href="http://mnapoli.fr/">Matthieu Napoli</a>
                    and <a href="https://github.com/PHP-DI/PHP-DI/graphs/contributors">contributors</a>
                    |
                    Website generated with
                    <a href="http://mnapoli.fr/Couscous/" target="_blank">Couscous</a>.
                </p>
            </div>
        </footer>
    
            <script src="http://stratifyphp.github.io/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="http://stratifyphp.github.io/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

        <script>
            $(function() {
                hljs.initHighlightingOnLoad();
            });
        </script>
    
</body>
</html>
