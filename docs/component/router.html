<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Stratify - Your application, your architecture</title>

            <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
        <link href="http://stratifyphp.github.io/css/highlight.github.css" rel="stylesheet">
        <link href="http://stratifyphp.github.io/css/all.min.css" rel="stylesheet">
    </head>
<body>

    <header>
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://stratifyphp.github.io/">Stratify</a>
                </div>
                <div class="collapse navbar-collapse" id="top-navigation">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://stratifyphp.github.io/docs/">Documentation</a></li>
                        <li><a href="http://stratifyphp.github.io/middlewares/">Middlewares</a></li>
                        <li><a class="github" href="https://github.com/stratifyphp"><i class="fa fa-github"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    
    <div class="container documentation">

        <div class="sidebar">
            <ul>
                                    <li>
                        Components

                        <ul>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/component/http.html">
                                        Http
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/component/router.html">
                                        Router
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    <li>
                        Framework

                        <ul>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/getting-started.html">
                                        Getting started
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/modules.html">
                                        Modules
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://stratifyphp.github.io/docs/framework/extended-callables.html">
                                        Extended callables
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                            </ul>
        </div>

        <article>
            <h1 id="the-router-component">The Router component</h1>
<p>The Router component provides several routers <strong>implemented as middlewares</strong>.</p>
<h2 id="the-classic-router">The classic router</h2>
<p><code>Stratify\Router\Router</code> (aka the &quot;classic&quot; router) routes HTTP requests to handlers.</p>
<p>Example:</p>
<pre><code class="language-php">$router = new Router([
    '/' =&gt; function ($request, $response, $next) {
        $response-&gt;getBody()-&gt;write('Hello world!');
        return $response;
    },
]);</code></pre>
<h3 id="routes">Routes</h3>
<p>Routes are defined by mapping a URI path to a controller. By default only HTTP <code>GET</code> requests are allowed for a route.</p>
<p>If you need to add more constraints to the route, you can use the <code>route()</code> function helper:</p>
<pre><code class="language-php">use function Stratify\Router\route;

$router = new Router([
    '/' =&gt; route('controller')-&gt;method('POST'),
]);</code></pre>
<p>The route helper allows to set the following constraints:</p>
<ul>
<li>HTTP method: <code>-&gt;method('GET', 'POST', 'PUT')</code></li>
<li>HTTPS: <code>-&gt;secure()</code></li>
<li>regex for matching a path parameter: <code>-&gt;pattern($parameter, $regex)</code>
<pre><code class="language-php">'/user/{id}' =&gt; route('controller')-&gt;pattern('id', '\d+')</code></pre></li>
<li>optional path parameters: <code>-&gt;optional($parameter, $defautValue)</code>
<pre><code class="language-php">'/feed{format}' =&gt; route('controller')-&gt;optional('format', '.json')</code></pre></li>
</ul>
<h3 id="controllers">Controllers</h3>
<p>Controllers can be any PHP callable or <strong>extended callable</strong> (<a href="../extended-callables.html">read the documentation</a>).</p>
<h4 id="return-value">Return value</h4>
<p>A controller can return a response (like any middleware) or <strong>a string</strong> (which will be written to the response):</p>
<pre><code class="language-php">function ($request, $response, $next) {
    return 'Hello world';
}</code></pre>
<h4 id="parameters">Parameters</h4>
<p>The parameters passed to the controller are matched based on what parameters the controller expect. The following parameters can be used (from highest priority to lowest):</p>
<ul>
<li>middleware parameters: <code>$request</code>, <code>$response</code>, <code>$next</code></li>
<li>route path parameters</li>
<li>dependency injection using type-hints</li>
</ul>
<p>The list is from the highest priority to the lowest in case of collisions (e.g. if one of your route parameter is named <code>request</code> then the HTTP request will be injected, not the route parameter).</p>
<p>For example you can use the classic middleware signature:</p>
<pre><code class="language-php">'/{id}' =&gt; function ($request, $response, $next) {
    $id = $request-&gt;getAttribute('id');
    ...
}</code></pre>
<p>Or expect the route parameter directly:</p>
<pre><code class="language-php">'/{id}' =&gt; function ($id) {
    ...
}</code></pre>
<p>You can type-hint services to inject them:</p>
<pre><code class="language-php">'/' =&gt; function (Authentication $auth) {
    return 'Welcome ' . $auth-&gt;getCurrentUserName();
}</code></pre>
<p>Or even mix everything (the order doesn't matter):</p>
<pre><code class="language-php">'/{id}' =&gt; function ($id, $response, Authentication $auth) {
    ...
}</code></pre>
<p>Note that injecting services using type-hints will only work with container entries whose name is a class (or interface) name. You'll also find that dependency injection through parameters isn't very useful when your controller is a class (because in that case you can do classic dependency injection in the constructor).</p>
<h3 id="run">Run</h3>
<p>The router can be invoked directly:</p>
<pre><code class="language-php">$router($request, $response, $next);</code></pre>
<p>Like any other middleware, it takes a PSR-7 request, response and the next callable to invoke if no route matched. In most application, the <code>next</code> callable is usually returning a 404 response.</p>
<p>The router can also be added to a middleware-based application (like any other middleware) - this is how it is used in the Stratify framework.</p>
<h2 id="the-prefix-router">The prefix router</h2>
<p>The <code>Stratify\Router\PrefixRouter</code> is a very small and lightweight router that does only one thing: route to sub-middlewares based on a URL prefix.</p>
<pre><code class="language-php">$router = new PrefixRouter([
    '/api/'   =&gt; function ($request, $response, $next) {
        return ...;
    },
    '/admin/' =&gt; function ($request, $response, $next) {
        return ...;
    },
]);</code></pre>
<p>In this example, all URLs starting with <code>/api/</code> will be routed to the first middleware, and all starting with <code>/admin/</code> will be routed to the second one.</p>
<p>It is useful if you want to apply some middlewares only for specific parts of an application, for example:</p>
<ul>
<li>protect an <code>/admin/</code> section with an authentication middleware</li>
<li>cache the front-end part of an app with a cache middleware</li>
<li>use a &quot;REST router&quot; for the <code>/api/</code> part of the application, and use a classic router for the rest of the website</li>
</ul>
<p>Here is a more advanced example where we protect only the <code>/admin/</code> section with authentication:</p>
<pre><code class="language-php">$router = new PrefixRouter([

    '/api/'   =&gt; ...,

    '/admin/' =&gt; new MiddlewarePipe([
        function ($request, $response, $next) {
            // check authentication
        },
        new Router([
            '/admin/login' =&gt; [LoginController::class, 'login'],
        ]),
    ]),

]);</code></pre>
<p>However as you start to dive in such use cases, you are encouraged to look at the full Stratify framework which offers features dedicated to compose applications in that way.</p>
<p>Note: this router is an alternative to other framework's features like registering a middleware for a URL prefix, or route middlewares. Instead of having a do-it-all core that covers specific use cases (route middleware, path middleware, …), Stratify exposes one simple pattern (middleware) and lets you create complex behaviors by assembling very simple bricks (like the &quot;Unix philosophy&quot;).</p>
        </article>

    </div>


            <footer>
            <div class='container'>
                                    <p>
                        A question? Unsatisfied with the documentation?
                        Please <a href="https://github.com/PHP-DI/PHP-DI/issues/new">create an issue</a>
                        or chat on
                        <a href="https://gitter.im/PHP-DI/PHP-DI">Gitter</a> or
                        <a href="https://twitter.com/phpdi">Twitter</a>.
                    </p>
                                <p>
                    By <a href="http://mnapoli.fr/">Matthieu Napoli</a>
                    and <a href="https://github.com/PHP-DI/PHP-DI/graphs/contributors">contributors</a>
                    |
                    Website generated with
                    <a href="http://mnapoli.fr/Couscous/" target="_blank">Couscous</a>.
                </p>
            </div>
        </footer>
    
            <script src="http://stratifyphp.github.io/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="http://stratifyphp.github.io/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

        <script>
            $(function() {
                hljs.initHighlightingOnLoad();
            });
        </script>
    
</body>
</html>
